<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™.‡∏î‡∏û.‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô V2.3.6 (Official)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #1a1a1a; color: #e0e0e0; padding: 10px; margin: 0; }
        header { text-align: center; background: #b71c1c; color: white; padding: 15px; border-radius: 0 0 15px 15px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .container { max-width: 600px; margin: auto; }
        .form-group { background: #2d2d2d; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid #444; }
        .group-fire { border-top: 5px solid #ff5252; }
        .group-rescue { border-top: 5px solid #ffd740; }
        h3 { margin-top: 0; color: #fff; border-bottom: 1px solid #444; padding-bottom: 10px; }
        label { display: block; margin-top: 12px; font-weight: bold; font-size: 0.9em; color: #bbb; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; background-color: #3d3d3d; border: 1px solid #555; border-radius: 6px; color: #fff; box-sizing: border-box; font-size: 16px; }
        .car-grid, .time-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-submit { width: 100%; padding: 15px; margin-top: 20px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 1.1em; transition: 0.3s; }
        .btn-red { background: #d32f2f; box-shadow: 0 4px 0 #891a1a; }
        .btn-yellow { background: #fbc02d; color: #000; box-shadow: 0 4px 0 #c49000; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 15px; }
        .modal-container { background: #2d2d2d; padding: 20px; border-radius: 15px; width: 100%; max-width: 500px; border: 1px solid #555; max-height: 90vh; display: flex; flex-direction: column; }
        .modal-body { overflow-y: auto; flex-grow: 1; margin: 15px 0; background: #000; color: #00ff41; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; white-space: pre-wrap; font-size: 0.95em; border: 1px solid #333; }
        .copy-hint { display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #4caf50; color: white; padding: 10px 25px; border-radius: 30px; font-weight: bold; z-index: 2000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        
        .staff-selector { background: #1a1a1a; border-radius: 8px; padding: 10px; margin-top: 5px; max-height: 180px; overflow-y: auto; border: 1px solid #444; }
        .staff-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .staff-item { display: flex; align-items: center; gap: 8px; font-size: 0.85em; cursor: pointer; background: #333; padding: 4px 8px; border-radius: 4px; }
        .staff-item input { width: auto; margin-top: 0; }
        .group-title { font-size: 0.75em; color: #ffd740; margin: 8px 0 4px 0; border-bottom: 1px dashed #444; }
    </style>
</head>
<body>

<header>
    <h2>üöí ‡∏™.‡∏î‡∏û.‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô (V2.3.6)</h2>
</header>

<div class="container">
    <div class="form-group group-fire">
        <h3>üî• ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏•‡∏¥‡∏á‡πÑ‡∏´‡∏°‡πâ</h3>
        <label>üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏</label>
        <input type="text" id="fire_place" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà...">
        
        <label>üöí ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏</label>
        <div class="car-grid">
            <select id="fire_car1">
                <option value="">-- ‡∏£‡∏ñ 1 --</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 061-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 061-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 062-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 062-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 041-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 041-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 051-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 051-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 052-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 052-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 053-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 053-1</option>
            </select>
            <select id="fire_car2">
                <option value="">-- ‡∏£‡∏ñ 2 --</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 061-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 061-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 062-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 062-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 041-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 041-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 051-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 051-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 052-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 052-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 053-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 053-1</option>
            </select>
            <select id="fire_car3">
                <option value="">-- ‡∏£‡∏ñ 3 --</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 061-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 061-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 062-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 062-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 041-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 041-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 051-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 051-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 052-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 052-1</option>
                <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 053-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 053-1</option>
            </select>
        </div>

        <div class="time-grid" style="grid-template-columns: 1fr 1fr 1fr; margin-top: 10px;">
            <div class="time-item"><label>‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á</label><input type="time" id="f_t1"></div>
            <div class="time-item"><label>‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≠‡∏Å</label><input type="time" id="f_t2"></div>
            <div class="time-item"><label>‡∏ß.10</label><input type="time" id="f_t3"></div>
            <div class="time-item"><label>‡πÄ‡∏•‡∏¥‡∏Å ‡∏ß.10</label><input type="time" id="f_t4"></div>
            <div class="time-item"><label>‡∏ß.10 ‡∏™.‡∏î‡∏û.</label><input type="time" id="f_t5"></div>
        </div>
        
        <label>üë• ‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡πà‡∏≤‡∏ô)</label>
        <div class="staff-selector"><div id="fire_team_list"></div></div>
        
        <label>üì¢ ‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏ó‡πà‡∏≤‡∏ô)</label>
        <div class="staff-selector"><div id="fire_sender_list"></div></div>
        
        <button class="btn-submit btn-red" onclick="prepareReport('fire')">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏•‡∏¥‡∏á‡πÑ‡∏´‡∏°‡πâ</button>
    </div>

    <div class="form-group group-rescue">
        <h3>üêæ ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô / 501</h3>
        <label>üêæ ‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå / ‡πÄ‡∏´‡∏ï‡∏∏</label>
        <select id="res_type_text" onchange="toggleOther()">
            <option value="‡∏á‡∏π‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏°">üêç ‡∏á‡∏π‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏°</option>
            <option value="‡∏á‡∏π‡πÄ‡∏´‡πà‡∏≤">üêç ‡∏á‡∏π‡πÄ‡∏´‡πà‡∏≤</option>
            <option value="‡∏ï‡∏±‡∏ß‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏±‡∏ß‡∏ó‡∏≠‡∏á">ü¶é ‡∏ï‡∏±‡∏ß‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏±‡∏ß‡∏ó‡∏≠‡∏á</option>
            <option value="‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üõ†Ô∏è ‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
        </select>
        <input type="text" id="res_type_other" style="display:none; margin-top:10px;" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏∑‡πà‡∏ô‡πÜ">

        <label>üìè ‡∏Ç‡∏ô‡∏≤‡∏î/‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
        <input type="text" id="res_len_text" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2 ‡πÄ‡∏°‡∏ï‡∏£">
        <label>üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
        <input type="text" id="res_place" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà...">
        
        <label>üöí ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏</label>
        <select id="res_car_single">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏±‡∏ô‡∏£‡∏ñ --</option>
            <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 061-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 061-1</option>
            <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 062-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 062-1</option>
            <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 041-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 041-1</option>
            <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 051-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 051-1</option>
            <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 052-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 052-1</option>
            <option value="‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 053-1">‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô 053-1</option>
        </select>

        <div class="time-grid" style="margin-top: 10px;">
            <div class="time-item"><label>‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á</label><input type="time" id="r_t1"></div>
            <div class="time-item"><label>‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≠‡∏Å</label><input type="time" id="r_t2"></div>
            <div class="time-item"><label>‡∏ß.10</label><input type="time" id="r_t3"></div>
            <div class="time-item"><label>‡πÄ‡∏•‡∏¥‡∏Å ‡∏ß.10</label><input type="time" id="r_t4"></div>
            <div class="time-item"><label>‡∏ß.10 ‡∏™.‡∏î‡∏û.</label><input type="time" id="r_t5"></div>
        </div>

        <label>üë• ‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡πà‡∏≤‡∏ô)</label>
        <div class="staff-selector"><div id="res_team_list"></div></div>

        <label>üì¢ ‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏ó‡πà‡∏≤‡∏ô)</label>
        <div class="staff-selector"><div id="res_sender_list"></div></div>

        <button class="btn-submit btn-yellow" onclick="prepareReport('rescue')">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</button>
    </div>
</div>

<div id="previewOverlay" class="overlay">
    <div class="modal-container">
        <h3>üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
        <div id="previewBody" class="modal-body"></div>
        <div class="flex gap-3">
            <button class="flex-1 bg-gray-600 p-3 rounded-lg font-bold" onclick="closePreview()">‡∏Å‡∏•‡∏±‡∏ö</button>
            <button id="btnConfirmSend" class="flex-1 bg-green-600 p-3 rounded-lg font-bold text-white">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
    </div>
</div>

<div id="copyHint" class="copy-hint">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz5J5FMDXRS2feq7H3H12v9OCFsmpRt59YBiRoC9K2yzX92mUYyKRKm94SG0--d81LAgA/exec";

    function generateStaff() {
        const containers = {
            fTeam: document.getElementById('fire_team_list'),
            fSend: document.getElementById('fire_sender_list'),
            rTeam: document.getElementById('res_team_list'),
            rSend: document.getElementById('res_sender_list')
        };
        
        let html = '';
        for (let g = 1; g <= 4; g++) {
            html += `<div class="group-title">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô ${g}-X</div><div class="staff-grid">`;
            for (let i = 1; i <= 10; i++) {
                const name = `‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô ${g}-${i}`;
                html += `<label class="staff-item"><input type="checkbox" class="st-chk" value="${name}"> ${name}</label>`;
            }
            html += `</div>`;
        }

        containers.fTeam.innerHTML = html;
        containers.rTeam.innerHTML = html;
        
        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Radio)
        containers.fSend.innerHTML = html.replace(/type="checkbox" class="st-chk"/g, 'type="radio" name="f_sender"');
        containers.rSend.innerHTML = html.replace(/type="checkbox" class="st-chk"/g, 'type="radio" name="r_sender"');
    }
    generateStaff();

    function getThaiDate() {
        const d = new Date();
        const m = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
        return `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${d.getDate()} ${m[d.getMonth()]} ${d.getFullYear() + 543}`;
    }

    function toggleOther() {
        const s = document.getElementById('res_type_text');
        document.getElementById('res_type_other').style.display = (s.value === '‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏∑‡πà‡∏ô‡πÜ') ? 'block' : 'none';
    }

    let pendingData = null;

    function prepareReport(type) {
        let text = "";
        let json = {};
        const dateStr = getThaiDate();

        if (type === 'fire') {
            const place = document.getElementById('fire_place').value || '-';
            const cars = [document.getElementById('fire_car1').value, document.getElementById('fire_car2').value].filter(v => v).join(', ') || '-';
            const team = Array.from(document.querySelectorAll('#fire_team_list input:checked')).map(e => e.value).join(', ') || '-';
            const sender = (document.querySelector('input[name="f_sender"]:checked') || {value: '-'}).value;
            const t = { 1: document.getElementById('f_t1').value || '-', 2: document.getElementById('f_t2').value || '-', 3: document.getElementById('f_t3').value || '-', 4: document.getElementById('f_t4').value || '-', 5: document.getElementById('f_t5').value || '-' };

            text = `${dateStr}\n‡∏™.‡∏î‡∏û.‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô\nüî• ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏•‡∏¥‡∏á‡πÑ‡∏´‡∏°‡πâ\n------------------\nüìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${place}\n‚è∞ ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á: ${t[1]} ‡∏ô\n‚è∞ ‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≠‡∏Å: ${t[2]} ‡∏ô\n‚è∞ ‡∏ß.10: ${t[3]} ‡∏ô\n‚è∞ ‡πÄ‡∏•‡∏¥‡∏Å ‡∏ß.10: ${t[4]} ‡∏ô\n‚è∞ ‡∏ß.10 ‡∏™.‡∏î‡∏û.: ${t[5]} ‡∏ô\nüöí ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å: ${cars}\nüë• ‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô: ${team}\nüì¢ ‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ${sender}`;
            json = { type: "‡πÄ‡∏û‡∏•‡∏¥‡∏á‡πÑ‡∏´‡∏°‡πâ", date: dateStr, place: place, len: "-", staff: team, sender: sender, t1: t[1], t2: t[2], t3: t[3], t4: t[4], t5: t[5], car: cars };
        } else {
            let animal = document.getElementById('res_type_text').value;
            if(animal === '‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏∑‡πà‡∏ô‡πÜ') animal = document.getElementById('res_type_other').value || '‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
            const place = document.getElementById('res_place').value || '-';
            const size = document.getElementById('res_len_text').value || '-';
            const car = document.getElementById('res_car_single').value || '-';
            const team = Array.from(document.querySelectorAll('#res_team_list input:checked')).map(e => e.value).join(', ') || '-';
            const sender = (document.querySelector('input[name="r_sender"]:checked') || {value: '-'}).value;
            const t = { 1: document.getElementById('r_t1').value || '-', 2: document.getElementById('r_t2').value || '-', 3: document.getElementById('r_t3').value || '-', 4: document.getElementById('r_t4').value || '-', 5: document.getElementById('r_t5').value || '-' };

            text = `${dateStr}\n‡∏™.‡∏î‡∏û.‡∏ö‡∏≤‡∏á‡∏ö‡∏≠‡∏ô\nüêæ ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (${animal})\n------------------\nüìè ‡∏Ç‡∏ô‡∏≤‡∏î: ${size}\nüìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${place}\n‚è∞ ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á: ${t[1]} ‡∏ô\n‚è∞ ‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≠‡∏Å: ${t[2]} ‡∏ô\n‚è∞ ‡∏ß.10: ${t[3]} ‡∏ô\n‚è∞ ‡πÄ‡∏•‡∏¥‡∏Å ‡∏ß.10: ${t[4]} ‡∏ô\n‚è∞ ‡∏ß.10 ‡∏™.‡∏î‡∏û.: ${t[5]} ‡∏ô\nüöí ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å: ${car}\nüë• ‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô: ${team}\nüì¢ ‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ${sender}`;
            json = { type: `501 (${animal})`, date: dateStr, place: place, len: size, staff: team, sender: sender, t1: t[1], t2: t[2], t3: t[3], t4: t[4], t5: t[5], car: car };
        }

        pendingData = { text, json };
        document.getElementById('previewBody').innerText = text;
        document.getElementById('previewOverlay').style.display = 'flex';
        document.getElementById('btnConfirmSend').onclick = sendFinal;
    }

    function closePreview() { document.getElementById('previewOverlay').style.display = 'none'; }

    function sendFinal() {
        if (!pendingData) return;
        const { text, json } = pendingData;
        
        // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î
        const el = document.createElement('textarea');
        el.value = text;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);

        // ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Sheets
        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(json) });
        
        const hint = document.getElementById('copyHint');
        hint.style.display = 'block';
        setTimeout(() => { hint.style.display = 'none'; }, 2500);
        closePreview();
    }
</script>
</body>
</html>
